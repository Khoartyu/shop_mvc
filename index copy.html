<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Trang Chủ | Cửa hàng</title>
  <link rel="stylesheet" href="css/style.css">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
  <div class="container-fluid mb-5 ccr">
    <h5 class="text-center mt-4 mb-4" style="font-weight:600;">Sale Nhanh Chớp Ngay ⚡</h5>
    <div class="row" id="dsSanPham"></div>
  </div>

<script>
fetch('api/index.php?action=layTatCa')
  .then(res => res.json())
  .then(ds => {
    let html = '';
    ds.forEach((sp, index) => {
      // Tách danh sách ảnh trong CSDL (ngăn cách bằng dấu phẩy)
      const dsAnh = sp.hinh_anh.split(',');
      const carouselId = `carousel${index + 1}`;

      html += `
        <div class="col-lg-3 col-6">
          <div id="${carouselId}" class="carousel carousel-dark slide" data-bs-ride="carousel">
            <div class="carousel-indicators">
              ${dsAnh.map((_, i) => `
                <button type="button" data-bs-target="#${carouselId}" data-bs-slide-to="${i}" 
                  ${i === 0 ? 'class="active" aria-current="true"' : ''} aria-label="Slide ${i + 1}">
                </button>`).join('')}
            </div>

            <div class="carousel-inner">
              ${dsAnh.map((anh, i) => `
                <div class="carousel-item ${i === 0 ? 'active' : ''}">
                  <img src="${anh.trim()}" class="d-block w-100" alt="${sp.ten_san_pham}">
                </div>`).join('')}
            </div>

            <button class="carousel-control-prev" type="button" data-bs-target="#${carouselId}" data-bs-slide="prev">
              <span class="carousel-control-prev-icon" aria-hidden="true"></span>
              <span class="visually-hidden">Previous</span>
            </button>

            <button class="carousel-control-next" type="button" data-bs-target="#${carouselId}" data-bs-slide="next">
              <span class="carousel-control-next-icon" aria-hidden="true"></span>
              <span class="visually-hidden">Next</span>
            </button>

            <div class="price">
              <span class="mb-1">
                <span style="text-decoration:line-through">${(sp.gia * 1.2).toLocaleString()}đ</span>
                <span style="color:#ff0000">&nbsp;${Number(sp.gia).toLocaleString()}đ</span>
              </span>
            </div>
          </div>
        </div>
      `;
    });

    document.querySelector('.row').innerHTML = html;
  })
  .catch(err => {
    console.error('Lỗi tải sản phẩm:', err);
    document.querySelector('.row').innerHTML = '<p class="text-danger text-center">Không tải được danh sách sản phẩm!</p>';
  });
</script>

</body>
</html>
